backend:
  name: backend
  image: saytruth/backend
  tag: latest
  pullPolicy: Never
  port: 8000
  replicas: 1
  configMapName: backend-config
  secretName: backend-secret
  config:
    DOMAIN: "localhost"
    API_PORT: "8000"
    API_HOST: "0.0.0.0"
    ACCESS_TOKEN_EXPIRE_MINUTES: "1440"
    LOG_LEVEL: "INFO"
    DEBUG: "true"
    ENVIRONMENT: "development"
    DB_HOST: "postgres-service"
    DB_PORT: "5432"
    DB_NAME: "saytruth_db"
    GOOGLE_CLIENT_ID: ""
  secret:
    JWT_SECRET: "Z6BkzaWcF7r5cC-VMAumjpBpudSyjGskQ0ObquGJhG0="
    ENCRYPTION_KEY: "Vv3oE5-p_z1rM3DqK_u_M-7yY_X8z3R_L_k9wB-nS8E="
    DB_USER: "saytruth_user"
    DB_PASSWORD: "DevSecurePass123!@#"
  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  livenessProbe:
    path: /health
    initialDelaySeconds: 20
    periodSeconds: 10
    timeoutSeconds: 5
  readinessProbe:
    path: /health
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3

frontend:
  name: frontend
  image: saytruth/frontend
  tag: latest
  pullPolicy: Never
  port: 5173
  replicas: 1
  configMapName: frontend-config
  config:
    NODE_ENV: "development"
    VITE_API_BASE_URL: ""
    VITE_GOOGLE_CLIENT_ID: ""
  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  livenessProbe:
    path: /
    initialDelaySeconds: 15
    periodSeconds: 10
  readinessProbe:
    path: /
    initialDelaySeconds: 10
    periodSeconds: 5

kong:
  name: kong
  image: kong
  tag: alpine
  pullPolicy: IfNotPresent
  replicas: 1
  configMapName: kong-config
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  ports:
    - name: http
      containerPort: 8000
    - name: https
      containerPort: 8443
    - name: admin
      containerPort: 8001
  env:
    - name: KONG_DATABASE
      value: "off"
    - name: KONG_DECLARATIVE_CONFIG
      value: /etc/kong/kong.yaml
    - name: KONG_PROXY_ACCESS_LOG
      value: /dev/stdout
    - name: KONG_ADMIN_ACCESS_LOG
      value: /dev/stdout
    - name: KONG_PROXY_ERROR_LOG
      value: /dev/stderr
    - name: KONG_ADMIN_ERROR_LOG
      value: /dev/stderr
    - name: KONG_ADMIN_LISTEN
      value: "0.0.0.0:8001"
  service:
    type: LoadBalancer
    ports:
      - name: http
        port: 80
        targetPort: 8000
        nodePort: 80
      - name: https
        port: 443
        targetPort: 8443
        nodePort: 80
  config:
    kongYaml: |
      _format_version: "2.1"
      services:
        - name: backend-service
          url: http://backend-service:8000
          routes:
            - name: api-route
              paths:
                - /api
              strip_path: false
            - name: health-route
              paths:
                - /health
              strip_path: false
        - name: frontend-service
          url: http://frontend-service:5173
          routes:
            - name: frontend-route
              paths:
                - /
              strip_path: false

postgres:
  name: postgres
  image: postgres
  tag: 15-alpine
  port: 5432
  replicas: 1
  secretName: postgres-secret
  pvc:
    name: postgres-pvc
    storageClassName: local-path
    accessModes:
      - ReadWriteOnce
    size: 5Gi
  secret:
    POSTGRES_USER: saytruth_user
    POSTGRES_PASSWORD: "DevSecurePass123!@#"
    POSTGRES_DB: saytruth_db
    POSTGRES_ADMIN_PASSWORD: "AdminPass123!@#"
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  livenessProbe:
    initialDelaySeconds: 15
    periodSeconds: 10
  readinessProbe:
    initialDelaySeconds: 10
    periodSeconds: 5

# Ingress configuration (routes port 80 to Kong)
ingress:
  enabled: true
  name: saytruth-ingress
  ingressClassName: traefik
  annotations: {}
  # For HTTPS with domain name:
  # annotations:
  #   cert-manager.io/cluster-issuer: letsencrypt-prod
  host: ""  # Empty for IP-based access, set to domain name for production
  paths:
    - path: /
      pathType: Prefix
      serviceName: kong-service
      servicePort: 80
  # TLS configuration (for HTTPS)
  tls: []
  # Example for production with domain:
  # tls:
  #   - hosts:
  #       - saytruth.com
  #     secretName: saytruth-tls
